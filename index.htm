<!DOCTYPE html>
<html lang="ru" data-bs-theme="dark">

<head>
    <meta name="darkreader-lock">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>–ü–æ–¥–±–æ—Ä —Å–µ—Ä–≤–µ—Ä–∞‚Ä¶</title>

    <!-- Primary Meta Tags -->
    <link rel="icon" type="image/x-icon" href="/favicon.png" id="fav">
    <title>Track Anime By –î—É–≥–î—É–≥</title>

    <link rel="canonical" href="https://track-anime.dygdyg.ru/">

    <meta name="title" content="Track Anime By –î—É–≥–î—É–≥">
    <meta name="description"
        content="–°–µ—Ä–≤–∏—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∞–Ω–∏–º–µ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—ã—Ö–æ–¥–∞ –Ω–æ–≤—ã—Ö —Å–µ—Ä–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –î–ª—è —Å–≤—è–∑–∏ —Å–æ –º–Ω–æ–π –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –≤ –º–æ–π discord: .dygdyg">
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="//track-anime.dygdyg.ru">
    <meta property="og:title" content="Track Anime By –î—É–≥–î—É–≥">
    <meta property="og:description"
        content="–°–µ—Ä–≤–∏—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∞–Ω–∏–º–µ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—ã—Ö–æ–¥–∞ –Ω–æ–≤—ã—Ö —Å–µ—Ä–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –î–ª—è —Å–≤—è–∑–∏ —Å–æ –º–Ω–æ–π –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –≤ –º–æ–π discord: .dygdyg">
    <meta property="og:image" content="/favicon.png">
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <!-- <meta property="twitter:url" content="//track-anime.github.io"> -->
    <meta property="twitter:title" content="Track Anime By –î—É–≥–î—É–≥">
    <meta property="twitter:description"
        content="–°–µ—Ä–≤–∏—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∞–Ω–∏–º–µ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—ã—Ö–æ–¥–∞ –Ω–æ–≤—ã—Ö —Å–µ—Ä–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –î–ª—è —Å–≤—è–∑–∏ —Å–æ –º–Ω–æ–π –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –≤ –º–æ–π discord: .dygdyg">
    <meta property="twitter:image" content="/favicon.png">
    <meta property="twitter:image:alt"
        content="–°–µ—Ä–≤–∏—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∞–Ω–∏–º–µ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—ã—Ö–æ–¥–∞ –Ω–æ–≤—ã—Ö —Å–µ—Ä–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –î–ª—è —Å–≤—è–∑–∏ —Å–æ –º–Ω–æ–π –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –≤ –º–æ–π discord: .dygdyg">

    <!-- –ñ—ë—Å—Ç–∫–æ –æ—Ç–∫–ª—é—á–∞–µ–º –∫–µ—à -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <style>
        body {
            font-family: system-ui, sans-serif;
            background: #0e0e0e;
            color: #eaeaea;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        .box {
            text-align: center;
            max-width: 520px;
        }

        .loader {
            margin: 20px auto;
            width: 40px;
            height: 40px;
            border: 4px solid #333;
            border-top: 4px solid #4caf50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .error {
            color: #f44336;
        }

        small {
            color: #888;
        }
    </style>
</head>

<body>

    <div class="box">
        <h1>üåê –ü–æ–¥–±–æ—Ä —Å–µ—Ä–≤–µ—Ä–∞</h1>
        <p id="status">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è‚Ä¶</p>
        <div class="loader"></div>
    </div>

    <script>
        // ===============================
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        // ===============================
        const mirrors = [
            "https://track-anime.dygdyg.ru",
            "https://track-anime.duckdns.org",
            // "https://server.dygdyg.ru",
            // "https://dygdyg.duckdns.org"
        ];

        const CHECK_PATH = "/scripts/moment.js";
        const TIMEOUT = 4000;
        const REQUIRED_SUCCESSES = 3;
        const RETRY_DELAY = 3000;

        // ===============================
        function sleep(ms) {
            return new Promise(r => setTimeout(r, ms));
        }

        // ===============================
        // –û–¥–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞
        // ===============================
        async function checkOnce(baseUrl) {
            const controller = new AbortController();
            const timeout = setTimeout(() => controller.abort(), TIMEOUT);

            try {
                await fetch(
                    `${baseUrl}${CHECK_PATH}?nocache=${crypto.randomUUID()}`,
                    {
                        mode: "no-cors",
                        cache: "no-store",
                        signal: controller.signal
                    }
                );
                return true;
            } catch {
                return false;
            } finally {
                clearTimeout(timeout);
            }
        }

        // ===============================
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ (3/3)
        // ===============================
        async function verifyMirror(baseUrl, statusEl) {
            for (let i = 1; i <= REQUIRED_SUCCESSES; i++) {
                statusEl.textContent =
                    `–ü—Ä–æ–≤–µ—Ä–∫–∞ ${baseUrl} (${i}/${REQUIRED_SUCCESSES})‚Ä¶`;

                if (!(await checkOnce(baseUrl))) {
                    return false;
                }
            }
            return true;
        }

        // ===============================
        // –û—Å–Ω–æ–≤–Ω–æ–π –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª
        // ===============================
        (async function mainLoop() {
            const status = document.getElementById("status");
            let round = 1;

            while (true) {
                status.textContent = `üîÅ –¶–∏–∫–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ #${round}`;

                for (const mirror of mirrors) {
                    if (await verifyMirror(mirror, status)) {
                        // —Ä–µ–¥–∏—Ä–µ–∫—Ç –°–†–ê–ó–£
                        const params = new URLSearchParams(window.location.search);
                        // params.set("_ts", Date.now());

                        window.location.replace(
                            `${mirror}/?${params.toString()}`
                        );
                        return;
                    }
                }

                status.innerHTML =
                    `<span class="error">‚ùå –°–µ—Ä–≤–µ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ ${RETRY_DELAY / 1000}—Å‚Ä¶</span>`;

                round++;
                await sleep(RETRY_DELAY);
            }
        })();

        // ===============================
        // –û—Ç–∫–ª—é—á–∞–µ–º BFCache
        // ===============================
        window.addEventListener("pageshow", e => {
            if (e.persisted) location.reload();
        });
    </script>

</body>

</html>